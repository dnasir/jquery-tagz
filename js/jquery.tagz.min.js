/*
	jQuery Tagz Plugin 1.0.5
	
	Copyright (c) 2013 Dzulqarnain Nasir

	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php

	dzul1983@gmail.com

	This project is based on the jQuery Tags Input Plugin project by XOXCO
	Original project URL: http://xoxco.com/clickable/jquery-tags-input
*/
(function(d){var a={autocompleteOnly:false,autocompleteOptions:undefined,autosize:true,comfortZone:20,delimiter:",",height:100,inputPadding:12,minChars:0,placeholderColor:"#666666",placeholderText:"Add a tag",readonly:false,removeWithBackspace:true,showInput:false,unique:true,width:300,onReady:function(){},onDestroy:function(){},onAddTag:function(){},onRemoveTag:function(){},onChange:function(){}};function b(f,e){this.el=d(f);this.options=d.extend({},a,e);c.init.apply(this)}var c={init:function(){if(!this.options.showInput){this.el.hide()}var f=this.el.attr("disabled");if(typeof f!=="undefined"&&f!==false){this.options.readonly=true}var g=this.el.attr("id");if(!g){g=this.el.attr("id","tags"+new Date().getTime()).attr("id")}var e='<div id="'+g+'_tagsInput" class="tagsinput"><div id="'+g+'_addTag">';if(!this.options.readonly){e+='<input id="'+g+'_tag" value="" data-placeholder="'+this.options.placeholderText+'" />'}e+='</div><div class="tags_clear"></div></div>';this.el.after(e);d.extend(this,{holder:d("#"+g+"_tagsInput"),inputWrapper:d("#"+g+"_addTag"),fakeInput:d("#"+g+"_tag")});this.holder.css({width:this.options.width,minHeight:this.options.height,height:"100%"});if(this.el.val()!=""){c.importTags.apply(this)}if(this.options.readonly){return}this.fakeInput.val(this.fakeInput.attr("data-placeholder")).css("color",this.options.placeholderColor);c.resetAutosize.apply(this);this.el.on("addTag",this,function(h,i){h.data.options.onAddTag.call(h.data,i)}).on("removeTag",this,function(h,i){h.data.options.onRemoveTag.call(h.data,i)}).on("change",this,function(h,i){h.data.options.onChange.call(h.data,i)});this.holder.on("click",this,function(h){h.data.fakeInput.focus()}).on("click","a.remove-tag",d.proxy(function(h){h.preventDefault();c.removeTag.call(this,h.target.parentElement)},this));this.fakeInput.on("focus",this,function(h){if(h.data.fakeInput.val()==h.data.fakeInput.attr("data-placeholder")){h.data.fakeInput.val("")}h.data.fakeInput.css("color","#000000")}).on("blur",this,d.proxy(function(h){var i=h.data.fakeInput.val();if((i!=""&&i!=h.data.fakeInput.attr("data-placeholder"))&&(i.length>=h.data.options.minChars&&(!h.data.options.maxChars||i.length<=h.data.options.maxChars))){c.addTag.call(this,i)}else{h.data.fakeInput.val(h.data.fakeInput.attr("data-placeholder")).css("color",this.options.placeholderColor)}return false},this)).on("keypress",this,d.proxy(function(h){if(h.which==h.data.options.delimiter.charCodeAt(0)||h.which==13){h.preventDefault();var i=h.data.fakeInput.val();if(i.length>=h.data.options.minChars&&(!h.data.options.maxChars||i.length<=h.data.options.maxChars)){c.addTag.call(this,i)}c.resetAutosize.apply(this);return false}else{if(h.data.options.autosize){c.doAutosize.apply(this)}}},this));if(this.options.removeWithBackspace){this.fakeInput.on("keydown",d.proxy(function(i){if(i.keyCode==8&&this.fakeInput.val()==""){i.preventDefault();var h=this.holder.find(".tag:last");c.removeTag.call(this,h);this.fakeInput.trigger("focus")}},this))}if(this.options.unique){this.fakeInput.keydown(d.proxy(function(h){if(h.keyCode==8||String.fromCharCode(h.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){this.fakeInput.removeClass("not_valid")}},this))}if(this.options.autocompleteOptions){if(d.ui.autocomplete!==undefined){this.fakeInput.autocomplete(this.options.autocompleteOptions);this.fakeInput.on("autocompleteselect",this,d.proxy(function(h,i){this.fakeInput.val(i.item.value);c.addTag.call(this,i.item.value);return false},this));if(this.options.autocompleteOnly){this.options.allowedValues=[];this.fakeInput.on("autocompleteresponse",d.proxy(function(h,i){this.options.allowedValues=Object.prototype.toString.call(i.content)==="[object Array]"?d.map(i.content,function(k,j){return k.value}):[]},this)).on("autocompleteclose",d.proxy(function(h,i){this.options.allowedValues=[]},this))}}}this.fakeInput.blur();this.options.onReady.call(this.el[0])},addTag:function(f){if(this.options.autocompleteOnly){if(!this.options.allowedValues){this.options.allowedValues=[]}if(d.inArray(f,this.options.allowedValues)==-1){return false}}var g=this.el.val().split(this.options.delimiter);if(g[0]==""){g=[]}f=d.trim(f);if(this.options.unique&&c.tagExist.call(this,f)){this.fakeInput.addClass("not_valid");return false}var e='<span class="tag"><span>'+f+"</span>";if(!this.options.readonly){e+='&nbsp;&nbsp;<a href="#'+f+'" title="Remove tag" class="remove-tag">x</a>'}e+="</span>";g.push(f);c.updateTagsField.call(this,g);this.inputWrapper.before(e);this.fakeInput.val("").focus();this.el.trigger("addTag",f).trigger("change",g.join(this.options.delimiter))},removeTag:function(g){var f=this.holder.find(".tag");if(g===Object(g)){f.filter(g).remove();g=unescape(d(g).find("> span").text())}else{g=unescape(g);if(!c.tagExist.call(this,g)){return}f.filter(function(){return d.trim(d(this).find("> span").text())==g}).remove()}var h=this.el.val().split(this.options.delimiter),e=d.inArray(g,h);h.splice(e,1);c.updateTagsField.call(this,h);this.el.trigger("removeTag",g).trigger("change",h.join(this.options.delimiter))},doAutosize:function(){var g=this.el.data("minwidth"),n=this.el.data("maxwidth"),j="",m=d(this),i=d("#"+d(this).data("tester_id"));if(j===(j=this.el.val())){return}var f=j.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");i.html(f);var l=i.width(),k=(l+this.options.comfortZone)>=g?l+this.options.comfortZone:g,h=this.el.width(),e=(k<h&&k>=g)||(k>g&&k<n);if(e){this.el.width(k)}},resetAutosize:function(){var g=this.el.data("minwidth")||this.options.minInputWidth||this.el.width(),h=this.el.data("maxwidth")||this.options.maxInputWidth||(this.holder.width()-this.options.inputPadding),f=d("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:this.el.css("fontSize"),fontFamily:this.el.css("fontFamily"),fontWeight:this.el.css("fontWeight"),letterSpacing:this.el.css("letterSpacing"),whiteSpace:"nowrap"}),e=this.el.attr("id")+"_autosize_tester";if(!d("#"+e).length>0){f.attr("id",e);f.appendTo("body")}this.el.data("minwidth",g).data("maxwidth",h).data("tester_id",e).css("width",g)},tagExist:function(e){var f=this.el.val().split(this.options.delimiter);return d.inArray(e,f)!=-1},importTags:function(){var g=this.el.val().split(this.options.delimiter);this.el.val("");for(var f=0,e=g.length;f<e;f++){c.addTag.call(this,g[f])}},updateTagsField:function(e){this.el.val(e.join(this.options.delimiter))},destroy:function(){this.holder.remove();this.el.removeAttr("style").show().removeData("plugin__tagsInput");this.options.onDestroy.call(this.el[0])}};b.prototype={addTag:function(e){c.addTag.call(this,e);return this.el},removeTag:function(e){c.removeTag.call(this,e);return this.el},tagExist:function(e){return c.tagExist.call(this,e)},destroy:function(){c.destroy.call(this);return this.el}};d.fn.tagz=function(g){if(typeof g==="string"){var f=arguments,e;if(this.length>1){return this.each(function(){e=d(this).data("plugin__tagsInput");e[g].apply(e,Array.prototype.slice.call(f,1))})}else{e=d(this).data("plugin__tagsInput");return e[g].apply(e,Array.prototype.slice.call(f,1))}}else{if(typeof g==="object"||!g){return this.each(function(){d(this).data("plugin__tagsInput",new b(this,g))})}else{d.error("Method "+g+" not found.")}}}})(jQuery);